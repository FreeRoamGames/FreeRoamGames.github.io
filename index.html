<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VR Malen</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.110.0/examples/js/webxr/VRButton.js"></script>
</head>
<body>
    <h1>VR Malen</h1>
    <button id="vr-button"></button>
    <script>
        // Szene und Renderer
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.xr.enabled = true;
        document.body.appendChild(renderer.domElement);

        // VR Button
        document.body.appendChild(VRButton.createButton(renderer));

        // Kamera-Position
        camera.position.z = 5;

        // Malen: Geometrien speichern
        const points = [];
        const drawMaterial = new THREE.LineBasicMaterial({ color: 0xff0000 });

        function drawLine(pointA, pointB) {
            const geometry = new THREE.BufferGeometry().setFromPoints([pointA, pointB]);
            const line = new THREE.Line(geometry, drawMaterial);
            scene.add(line);
        }

        // Event-Handling fÃ¼r Desktop
        let isDrawing = false;
        let lastPoint = null;

        window.addEventListener('mousedown', (event) => {
            isDrawing = true;
            lastPoint = new THREE.Vector3(
                (event.clientX / window.innerWidth) * 2 - 1,
                -(event.clientY / window.innerHeight) * 2 + 1,
                0
            );
        });

        window.addEventListener('mousemove', (event) => {
            if (isDrawing) {
                const currentPoint = new THREE.Vector3(
                    (event.clientX / window.innerWidth) * 2 - 1,
                    -(event.clientY / window.innerHeight) * 2 + 1,
                    0
                );
                if (lastPoint) {
                    drawLine(lastPoint, currentPoint);
                }
                lastPoint = currentPoint;
            }
        });

        window.addEventListener('mouseup', () => {
            isDrawing = false;
            lastPoint = null;
        });

        // VR Controller-Handling
        function onSelectStart(event) {
            const controller = event.target;
            controller.userData.isDrawing = true;
            controller.userData.lastPoint = controller.position.clone();
        }

        function onSelectEnd(event) {
            const controller = event.target;
            controller.userData.isDrawing = false;
        }

        function handleVRController(controller) {
            if (controller.userData.isDrawing) {
                const currentPoint = controller.position.clone();
                if (controller.userData.lastPoint) {
                    drawLine(controller.userData.lastPoint, currentPoint);
                }
                controller.userData.lastPoint = currentPoint;
            }
        }

        const controller1 = renderer.xr.getController(0);
        controller1.addEventListener('selectstart', onSelectStart);
        controller1.addEventListener('selectend', onSelectEnd);
        scene.add(controller1);

        const controller2 = renderer.xr.getController(1);
        controller2.addEventListener('selectstart', onSelectStart);
        controller2.addEventListener('selectend', onSelectEnd);
        scene.add(controller2);

        // Animationsloop
        function animate() {
            renderer.setAnimationLoop(() => {
                handleVRController(controller1);
                handleVRController(controller2);
                renderer.render(scene, camera);
            });
        }

        animate();
    </script>
</body>
</html>
